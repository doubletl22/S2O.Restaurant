<!DOCTYPE html>
<html>
<head>
    <title>MÃ n hÃ¬nh Báº¿p (S2O Kitchen)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
    <style>
        .order-card { border: 2px solid red; padding: 10px; margin: 10px; background: #ffe6e6; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ‘¨â€ğŸ³ Báº¾P - CHI NHÃNH 2222...</h1>
    <div id="status">Äang káº¿t ná»‘i...</div>
    
    <div id="orders-container">
        </div>

    <script>
        // 1. Káº¿t ná»‘i tháº³ng vÃ o Order API (Bá» qua Gateway Ä‘á»ƒ test cho dá»… trÆ°á»›c)
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("http://localhost:5000/hubs/orders") 
            .build();

        // 2. Láº¯ng nghe sá»± kiá»‡n "NewOrderCreated"
        connection.on("NewOrderCreated", (data) => {
            console.log("Nháº­n Ä‘Æ¡n:", data);
            
            const div = document.createElement("div");
            div.className = "order-card";
            div.innerHTML = `
                <h3>ğŸ”” TING TING! CÃ“ ÄÆ N Má»šI</h3>
                <p>Order ID: <b>${data.orderId}</b></p>
                <p>Message: ${data.message}</p>
                <p><i>(HÃ£y reload API Staff Ä‘á»ƒ xem chi tiáº¿t)</i></p>
            `;
            document.getElementById("orders-container").prepend(div);
            
            // CÃ³ thá»ƒ thÃªm Ã¢m thanh ting ting á»Ÿ Ä‘Ã¢y
            alert("Báº¾P Æ I! CÃ“ ÄÆ N Má»šI KÃŒA!");
        });

        // 3. Báº¯t Ä‘áº§u káº¿t ná»‘i
        connection.start().then(() => {
            document.getElementById("status").innerText = "âœ… ÄÃ£ káº¿t ná»‘i Socket!";
            document.getElementById("status").className = "success";
            
            // Quan trá»ng: Pháº£i Join vÃ o Ä‘Ãºng Group BranchId cá»§a quÃ¡n
            // Giáº£ sá»­ quÃ¡n cá»§a báº¡n ID lÃ : 22222222-2222-2222-2222-222222222222
            const branchId = "22222222-2222-2222-2222-222222222222"; 
            connection.invoke("JoinBranch", branchId);
            
        }).catch(err => {
            document.getElementById("status").innerText = "âŒ Lá»—i káº¿t ná»‘i: " + err;
        });
    </script>
</body>
</html>