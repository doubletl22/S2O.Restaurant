{
  "Routes": [
    // ==================================================================================
    // 1. AUTHENTICATION & IDENTITY (Ưu tiên cao)
    // ==================================================================================
    {
      "DownstreamPathTemplate": "/api/v1/auth/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/auth/{everything}",
      "UpstreamHttpMethod": [ "POST" ]
    },
    {
      "DownstreamPathTemplate": "/api/users/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/users/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ]
    },
    {
      "DownstreamPathTemplate": "/api/users",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/users",
      "UpstreamHttpMethod": [ "GET", "POST" ]
    },
    {
      "DownstreamPathTemplate": "/api/v1/staff/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/staff/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    {
      "DownstreamPathTemplate": "/api/v1/tenants/registration",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/tenants/registration",
      "UpstreamHttpMethod": [ "POST" ]
    },

    // ==================================================================================
    // 2. TENANT SERVICE (Branches, Tables)
    // ==================================================================================
    
    // Admin Dashboard (Stats)
    {
      "DownstreamPathTemplate": "/api/v1/admin/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/admin/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // --- Branches (Chi nhánh) ---
    {
      // [FIX] Route lấy danh sách: GET /api/v1/branches
      "DownstreamPathTemplate": "/api/v1/branches",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/branches",
      "UpstreamHttpMethod": [ "GET", "POST" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    {
      // Route chi tiết/xóa: /api/v1/branches/{id}
      "DownstreamPathTemplate": "/api/v1/branches/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/branches/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // --- Tables (Bàn) ---
    {
      "DownstreamPathTemplate": "/api/v1/tables",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/tables",
      "UpstreamHttpMethod": [ "GET", "POST" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    {
      "DownstreamPathTemplate": "/api/v1/tables/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/tables/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    
    // --- Tenants (Thông tin quán) ---
    {
      "DownstreamPathTemplate": "/api/v1/tenants/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/tenants/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // ==================================================================================
    // 3. CATALOG SERVICE (Products, Categories)
    // ==================================================================================

    // --- Categories (Danh mục) ---
    {
      // [FIX] Route lấy danh sách: GET /api/v1/categories
      "DownstreamPathTemplate": "/api/v1/categories",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/categories",
      "UpstreamHttpMethod": [ "GET", "POST" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    {
      "DownstreamPathTemplate": "/api/v1/categories/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/categories/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // --- Products (Món ăn) ---
    {
      "DownstreamPathTemplate": "/api/v1/products",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/products",
      "UpstreamHttpMethod": [ "GET", "POST" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    {
      "DownstreamPathTemplate": "/api/v1/products/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/products/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // ==================================================================================
    // 4. ORDER & PAYMENT (Storefront)
    // ==================================================================================
    {
      "DownstreamPathTemplate": "/api/v1/storefront/menus/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/storefront/menus/{everything}",
      "UpstreamHttpMethod": [ "GET" ]
    },
    {
      "DownstreamPathTemplate": "/api/v1/storefront/tenants/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/storefront/tenants/{everything}",
      "UpstreamHttpMethod": [ "GET" ]
    },
    {
      "DownstreamPathTemplate": "/api/v1/storefront/orders/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "order-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/storefront/orders/{everything}",
      "UpstreamHttpMethod": [ "POST" ]
    },
    {
      "DownstreamPathTemplate": "/api/v1/orders/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "order-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/orders/{everything}",
      "UpstreamHttpMethod": [ "GET", "PATCH" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] },
      "UpstreamHeaderTransform": { "X-Branch-Id": "Claims[branch_id] > value" }
    },
    {
      "DownstreamPathTemplate": "/api/v1/payments/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "payment-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/payments/{everything}",
      "UpstreamHttpMethod": [ "POST", "GET" ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    {
      "DownstreamPathTemplate": "/api/v1/tables/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ], 
      "UpstreamPathTemplate": "/api/v1/tables/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ]
    },
    {
      "DownstreamPathTemplate": "/api/v1/kitchen/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "order-api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/kitchen/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ]
    }
  ],
  "GlobalConfiguration": {
    "BaseUrl": "http://localhost:5000"
  }
}