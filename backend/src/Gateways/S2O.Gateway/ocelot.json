{
  "Routes": [
    // ==================================================================================
    // 1. PUBLIC STOREFRONT API (Khách hàng quét QR/Guest) - Không cần Token (AllowAnonymous)
    // ==================================================================================
    
    // Catalog: Lấy Menu
    {
      // --- Cấu hình cho TENANT Service (Bao gồm cả Admin Stats và Delete) ---
      "DownstreamPathTemplate": "/api/v1/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ {"Host": "s2o.tenant.api","Port": 8080 } ],
      "UpstreamPathTemplate": "/api/v1/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ] 
    },
    {
      // --- Cấu hình cho IDENTITY Service (Users) ---
      "DownstreamPathTemplate": "/api/users/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ {"Host": "s2o.identity.api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/users/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ]
    },
     {
      "DownstreamPathTemplate": "/api/users",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ {"Host": "s2o.identity.api", "Port": 8080 } ],
      "UpstreamPathTemplate": "/api/users",
      "UpstreamHttpMethod": [ "GET", "POST" ]
    },


    {
      "UpstreamPathTemplate": "/api/v1/storefront/menus/{everything}",
      "UpstreamHttpMethod": [ "GET" ],
      "DownstreamPathTemplate": "/api/v1/storefront/menus/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ]
    },
    // Tenant: Quét mã bàn (Lấy thông tin quán)
    {
      "UpstreamPathTemplate": "/api/v1/storefront/tenants/{everything}",
      "UpstreamHttpMethod": [ "GET" ],
      "DownstreamPathTemplate": "/api/v1/storefront/tenants/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ]
    },
    // Order: Khách đặt đơn (Guest Order)
    {
      "UpstreamPathTemplate": "/api/v1/storefront/orders/{everything}",
      "UpstreamHttpMethod": [ "POST" ],
      "DownstreamPathTemplate": "/api/v1/storefront/orders/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "order-api", "Port": 8080 } ]
    },

    // ==================================================================================
    // 2. AUTHENTICATION & IDENTITY
    // ==================================================================================
    
    // Login / Refresh Token
    {
      "UpstreamPathTemplate": "/api/v1/auth/{everything}",
      "UpstreamHttpMethod": [ "POST" ],
      "DownstreamPathTemplate": "/api/v1/auth/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ]
    },

    // ==================================================================================
    // 3. BACKOFFICE MANAGEMENT API (Cần Token - Admin/Owner/Staff)
    // ==================================================================================
    
    // --- IDENTITY SERVICE ---
    // Quản lý Nhân viên (Staff)
    {
      "UpstreamPathTemplate": "/api/v1/staff/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "DownstreamPathTemplate": "/api/v1/staff/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    // Đăng ký Tenant (Admin)
    {
      "UpstreamPathTemplate": "/api/v1/tenants/registration",
      "UpstreamHttpMethod": [ "POST" ],
      "DownstreamPathTemplate": "/api/v1/tenants/registration",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "identity-api", "Port": 8080 } ]
    },

    // --- TENANT SERVICE ---
    // Quản lý Quán (Admin Dashboard)
    {
      "UpstreamPathTemplate": "/api/v1/tenants/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT" ],
      "DownstreamPathTemplate": "/api/v1/tenants/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    // Quản lý Chi nhánh (Branches)
    {
      "UpstreamPathTemplate": "/api/v1/branches/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "DownstreamPathTemplate": "/api/v1/branches/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    // Quản lý Bàn (Tables)
    {
      "UpstreamPathTemplate": "/api/v1/tables/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "DownstreamPathTemplate": "/api/v1/tables/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "tenant-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // --- CATALOG SERVICE ---
    // Quản lý Sản phẩm (Products)
    {
      "UpstreamPathTemplate": "/api/v1/products/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],
      "DownstreamPathTemplate": "/api/v1/products/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },
    // Quản lý Danh mục (Categories)
    {
      "UpstreamPathTemplate": "/api/v1/categories/{everything}",
      "UpstreamHttpMethod": [ "GET", "POST", "DELETE" ],
      "DownstreamPathTemplate": "/api/v1/categories/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "catalog-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    },

    // --- ORDER SERVICE ---
    // Quản lý Đơn hàng (Staff/Owner)
    {
      "UpstreamPathTemplate": "/api/v1/orders/{everything}",
      "UpstreamHttpMethod": [ "GET", "PATCH" ], 
      "DownstreamPathTemplate": "/api/v1/orders/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "order-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] },
      // Forward Header chi nhánh để Service biết
      "UpstreamHeaderTransform": { "X-Branch-Id": "Claims[branch_id] > value" } 
    },

    // --- PAYMENT SERVICE ---
    {
      "UpstreamPathTemplate": "/api/v1/payments/{everything}",
      "UpstreamHttpMethod": [ "POST", "GET" ],
      "DownstreamPathTemplate": "/api/v1/payments/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [ { "Host": "payment-api", "Port": 8080 } ],
      "AuthenticationOptions": { "AuthenticationProviderKey": "Bearer", "AllowedScopes": [] }
    }
  ],
  "GlobalConfiguration": {
    "BaseUrl": "http://localhost:5000"
  }
}